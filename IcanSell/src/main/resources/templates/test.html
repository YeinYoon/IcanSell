<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>코드 테스트용 페이지</title>
	<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
</head>
<body>

관리자 목록
<table border="2px">
	<thead>
		<th>아이디</th>
		<th>이름</th>
		<th>이름수정</th>
		<th>삭제</th>
	</thead>
	<tbody>
		<tr th:each="a: ${adminList}">
			<td th:text="${a.adminId}"></td>
			<td th:text="${a.aName}"></td>
			<td><button class="putAdminName">이름수정</button></td>
			<td><button class="deleteAdmin">삭제</button></td>
		</tr>
	</tbody>
</table>

관리자 등록 구현<br>
	<input id="aName" type="text" placeholder="관리자 이름">
	<input id="aId" type="text" placeholder="관리자 ID">
	<input id="aPw" type="password" placeholder="관리자 PW">
	<button id="signup">관리자 등록</button> <br><br>
	
음료 등록 구현<br>
<form th:action="@{/api/addDrink}" method="POST" enctype="multipart/form-data">
	<input name="dName" type="text" placeholder="음료 이름">
	<input name="dPrice" type="text" placeholder="가격">
	<input name="dStock" type="number" placeholder="수량">
	<input name="dImage" type="file">
	<button id="add" type="submit">상품 등록</button>
</form>

로그아웃<br>
<form name="logoutForm" th:action="@{/logout}" method="post">
	<input type="submit" value="로그아웃하기"/>
</form>
	
<script th:inline="javascript">
	$(()=>{
		//관리자 등록
		$("#signup").on("click", ()=> {	
			var aName = $("#aName").val();
			var aId = $("#aId").val();
			var aPw = $("#aPw").val();
			var obj = {
				adminId : aId,
				aName : aName,
				aPw : aPw
			}
			
			const data = JSON.stringify(obj);
			const url = "/api/addAdmin";
			
			const csrfToken=/*[[${_csrf.token}]]*/ null;
			const csrfHeader=/*[[${_csrf.headerName}]]*/ null;
			
			$.ajax({
				url:url,
				type:"post",
				contentType:'application/json',
				data:data,
				beforeSend:function(xhr){ xhr.setRequestHeader(csrfHeader, csrfToken);}
			})
			.done((result)=>{
				if(result.result == "ok") {
					alert("관리자 등록 완료");
					location.href="/admin/test"
				} else {
					alert("등록실패! 이미 있는 관리자 입니다.");
				}
			})
			.fail((err)=>{
				alert("관리자 등록 실패");
			});	
			
		});
			
		// 관리자 이름 수정
		$('.putAdminName').click(function () {
			var inputName = prompt("관리자의 새로운 이름을 입력해 주세요.");
			if (inputName == "" || inputName == $(this).closest("tr").children().eq(1).text()) {
				alert("공백값이나 동일한 이름은 입력할 수 없습니다.");
			} else {
				var adminId = $(this).closest("tr").children().eq(0).text();

				var obj = {
					adminId: adminId,
					newadminName: inputName
				}

				var url = "/api/putAdminName";
				var data = JSON.stringify(obj);

				const csrfToken =/*[[${_csrf.token}]]*/ null;
				const csrfHeader =/*[[${_csrf.headerName}]]*/ null;

				$.ajax({
					url: url,
					type: "put",
					contentType: 'application/json',
					data: data,
					beforeSend: function (xhr) {xhr.setRequestHeader(csrfHeader, csrfToken);}

				})
					.done((result) => {
						if (result.result == "ok") {
							alert("이름 수정완료");
							location.href="/admin/test";
						} else {
							alert("존재하지 않는 관리자 입니다.");
						}
					})
					.fail((err) => {
						alert("ERR : 수정 실패");
					})
			}

		});
	
		// 관리자 삭제
		$('.deleteAdmin').click(function () {
			var deleteAdmin = confirm("해당 관리자를 삭제하시겠습니까?");
			if(deleteAdmin == false) {
				alert("취소되었습니다.");
			} else {
				var adminId = $(this).closest("tr").children().eq(0).text();
			
				var obj={
					adminId : adminId
				}
			
				var url = "/api/deleteAdmin";
				var data = JSON.stringify(obj);
			
				const csrfToken=/*[[${_csrf.token}]]*/ null;
				const csrfHeader=/*[[${_csrf.headerName}]]*/ null;
		
				$.ajax({
					url:url,
					type:"delete",
					contentType:'application/json',
					data:data,
					beforeSend:function(xhr){ xhr.setRequestHeader(csrfHeader, csrfToken);}				
				})
				.done((result)=> {
					if(result.result == "ok") {
						alert("관리자 삭제 완료");
						location.href="/admin/test";
					} else {
						alert("존재하지 않는 관리자 입니다.");
					}
				})
				.fail((err)=> {
					alert("ERR : 삭제 실패");
				})
			}
		
		});
		
		
		
		
	});

</script>
</body>
</html>