<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<meta charset="UTF-8">
	<title>Document</title>
</head>

<body>
<nav>
	<div class="nav">
		<a href="">상품 등록</a>
		<a href="">상품 수정</a>
		<a href="">관리자 등록</a>
	</div>
</nav>

<div class="content">
	관리자 목록
	<table border="2px">
		<thead>
			<th>아이디</th>
			<th>이름</th>
			<th>이름수정</th>
			<th>삭제</th>
		</thead>
		<tbody>
			<tr th:each="a: ${adminList}">
				<td th:text="${a.adminId}"></td>
				<td th:text="${a.aName}"></td>
				<td><button class="putAdminName">이름수정</button></td>
				<td><button class="deleteAdmin">삭제</button></td>
			</tr>
		</tbody>
	</table>

	관리자 등록<br>
	<input id="aName" type="text" placeholder="관리자 이름">
	<input id="aId" type="text" placeholder="관리자 ID">
	<input id="aPw" type="password" placeholder="관리자 PW">
	<button id="signup">관리자 등록</button> <br><br>

</div>
	
	
	
	
<script th:inline="javascript">
	$(()=>{
		//관리자 등록
		$("#signup").on("click", ()=> {	
			var aName = $("#aName").val();
			var aId = $("#aId").val();
			var aPw = $("#aPw").val();
			var obj = {
				adminId : aId,
				aName : aName,
				aPw : aPw
			}
			
			const data = JSON.stringify(obj);
			const url = "/api/addAdmin";
			
			const csrfToken=/*[[${_csrf.token}]]*/ null;
			const csrfHeader=/*[[${_csrf.headerName}]]*/ null;
			
			$.ajax({
				url:url,
				type:"post",
				contentType:'application/json',
				data:data,
				beforeSend:function(xhr){ xhr.setRequestHeader(csrfHeader, csrfToken);}
			})
			.done((result)=>{
				if(result.result == "ok") {
					alert("관리자 등록 완료");
					location.href="/admin/member"
				} else {
					alert("등록실패! 이미 있는 관리자 입니다.");
				}
			})
			.fail((err)=>{
				alert("관리자 등록 실패");
			});	
			
		});
			
		// 관리자 이름 수정
		$('.putAdminName').click(function () {
			var inputName = prompt("관리자의 새로운 이름을 입력해 주세요.");
			if (inputName == "" || inputName == $(this).closest("tr").children().eq(1).text()) {
				alert("공백값이나 동일한 이름은 입력할 수 없습니다.");
			} else {
				var adminId = $(this).closest("tr").children().eq(0).text();

				var obj = {
					adminId: adminId,
					newadminName: inputName
				}

				var url = "/api/putAdminName";
				var data = JSON.stringify(obj);

				const csrfToken =/*[[${_csrf.token}]]*/ null;
				const csrfHeader =/*[[${_csrf.headerName}]]*/ null;

				$.ajax({
					url: url,
					type: "put",
					contentType: 'application/json',
					data: data,
					beforeSend: function (xhr) {xhr.setRequestHeader(csrfHeader, csrfToken);}

				})
					.done((result) => {
						if (result.result == "ok") {
							alert("이름 수정완료");
							location.href="/admin/member";
						} else {
							alert("존재하지 않는 관리자 입니다.");
						}
					})
					.fail((err) => {
						alert("ERR : 수정 실패");
					})
			}

		});
	
		// 관리자 삭제
		$('.deleteAdmin').click(function () {
			var deleteAdmin = confirm("해당 관리자를 삭제하시겠습니까?");
			if(deleteAdmin == false) {
				alert("취소되었습니다.");
			} else {
				var adminId = $(this).closest("tr").children().eq(0).text();
			
				var obj={
					adminId : adminId
				}
			
				var url = "/api/deleteAdmin";
				var data = JSON.stringify(obj);
			
				const csrfToken=/*[[${_csrf.token}]]*/ null;
				const csrfHeader=/*[[${_csrf.headerName}]]*/ null;
		
				$.ajax({
					url:url,
					type:"delete",
					contentType:'application/json',
					data:data,
					beforeSend:function(xhr){ xhr.setRequestHeader(csrfHeader, csrfToken);}				
				})
				.done((result)=> {
					if(result.result == "ok") {
						alert("관리자 삭제 완료");
						location.href="/admin/member";
					} else {
						alert("존재하지 않는 관리자 입니다.");
					}
				})
				.fail((err)=> {
					alert("ERR : 삭제 실패");
				})
			}
		
		});
		
		
		
		
	});
</script>
</body>
</html>